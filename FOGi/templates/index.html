<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FOGi — Tutora ODS 4</title>
  <style>
    body { font-family: system-ui, Arial; margin: 0; background:#f4f8ff; }
    .wrap { max-width: 860px; margin: 24px auto; padding: 16px; }
    .card { background:#fff; border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,.06); padding:16px; display:flex; flex-direction:column; gap:10px;}
    .msgs { height: 60vh; overflow:auto; padding:8px; display:flex; flex-direction:column;}
    .m { margin:6px 0; padding:10px 12px; border-radius:12px; line-height:1.45; max-width: 85%; }
    .m.user { background:#e8f3ff; align-self:flex-end }
    .m.bot  { background:#f6f6ff; align-self:flex-start }
    .row { display:flex; gap:8px; margin-top:6px }
    input { flex:1; padding:12px; border:1px solid #cfe3ff; border-radius:12px }
    button { padding:12px 16px; border:0; border-radius:12px; background:#38a5ff; color:#fff; font-weight:600; cursor:pointer }
    button:disabled { opacity:.5; cursor:not-allowed }
    small { color: #6b7280 }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>FOGi — Educação de Qualidade (ODS 4)</h2>
    <small>Dica: pergunte "FOGi, monta um plano de revisão de Matemática para 7 dias".</small>
    <div id="msgs" class="msgs"></div>
    <div class="row">
      <input id="msg" placeholder="Pergunte algo de estudo/ODS 4..." autocomplete="off"/>
      <button id="send">Enviar</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js"></script>
<script>
  const socket = io();
  const msgs = document.getElementById("msgs");
  const input = document.getElementById("msg");
  const sendBtn = document.getElementById("send");

  function appendMessage(text, who) {
    const div = document.createElement("div");
    div.className = "m " + (who || "bot");
    div.textContent = text;
    msgs.appendChild(div);
    msgs.scrollTop = msgs.scrollHeight;
    return div;
  }

  let assembling = null;

  function send() {
    const text = input.value.trim();
    if (!text) return;
    appendMessage(text, "user");
    input.value = "";
    assembling = appendMessage("...", "bot");
    socket.emit("user_message", { text });
    sendBtn.disabled = true;
  }

  sendBtn.onclick = send;
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") send();
  });

  socket.on("assistant_chunk", ({ text }) => {
    if (assembling) assembling.textContent += text;
  });

  socket.on("assistant_done", ({ full }) => {
    if (assembling) assembling.textContent = full;
    assembling = null;
    sendBtn.disabled = false;
  });

  socket.on("assistant_error", ({ message }) => {
    appendMessage("Erro: " + message, "bot");
    assembling = null;
    sendBtn.disabled = false;
  });
</script>
</body>
</html>
