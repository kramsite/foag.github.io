<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FOGi</title>

<style>
  :root{
    --azul:#38a5ff;
    --user:#e7f3ff;
    --bot:#ffffff;
    --gray:#d8dee9;
  }

  *{margin:0;padding:0;box-sizing:border-box;font-family:Poppins, Arial}

  body{
    height:100vh;
    display:flex;
    flex-direction:column;
    background:#f5faff;
    color:#0b1220;
  }

  /* topo */
  .top{
    background:#fff;
    border-bottom:1px solid var(--gray);
    padding:8px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:8px;
  }

  .logo{
    width:32px;
    height:32px;
    background:var(--azul);
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    font-weight:700;
  }

  .title{
    font-size:0.95rem;
    font-weight:600;
  }

  .close{
    background:none;
    border:none;
    font-size:1.3rem;
    cursor:pointer;
    padding:4px 8px;
    color:#555;
  }

  .close:hover{
    color:#000;
    transform:scale(1.1);
  }

  /* Ã¡rea do chat */
  .chat-wrap{
    flex:1;
    display:flex;
    flex-direction:column;
    min-height:0;
  }

  .msgs{
    flex:1;
    overflow-y:auto;
    padding:12px 10px 90px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .bubble{
    max-width:85%;
    padding:10px 12px;
    border-radius:6px;
    border:1px solid #e9eef6;
    font-size:0.95rem;
    line-height:1.4;
    word-break:break-word;
  }

  .bot{ background:var(--bot); align-self:flex-start; }
  .user{ background:var(--user); align-self:flex-end; }

  /* input */
  .composer{
    position:sticky;
    bottom:0;
    background:#fff;
    border-top:1px solid var(--gray);
    padding:10px;
    display:flex;
    gap:8px;
  }

  .composer input{
    flex:1;
    padding:12px;
    border:1px solid var(--gray);
    border-radius:6px;
    font-size:0.95rem;
    outline:none;
  }

  .composer input:focus{
    border-color:var(--azul);
    box-shadow:0 0 0 3px rgba(56,165,255,0.15);
  }

  .composer button{
    padding:0 16px;
    border:0;
    background:var(--azul);
    color:#fff;
    border-radius:6px;
    font-weight:600;
    cursor:pointer;
    height:40px;
  }

  .msgs::-webkit-scrollbar{width:7px;}
  .msgs::-webkit-scrollbar-thumb{background:#c5dbff;border-radius:99px;}
</style>
</head>
<body>

<header class="top">
  <div class="brand">
    <div class="logo">FOG</div>
    <div class="title">FOGi</div>
  </div>
  <button id="exit" class="close" title="Fechar">âœ•</button>
</header>

<div class="chat-wrap">
  <div id="msgs" class="msgs">
    <div class="bubble bot">Oi! Eu sou a FOGi. Manda sua dÃºvida aÃ­ rapidinho ðŸ˜„</div>
  </div>

  <div class="composer">
    <input id="msg" type="text" placeholder="Digite sua pergunta..." autocomplete="off">
    <button id="send">Enviar</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js"></script>
<script>
  const socket = io();
  const msgs = document.getElementById("msgs");
  const input = document.getElementById("msg");
  const sendBtn = document.getElementById("send");
  const exitBtn = document.getElementById("exit");

  let assembling = null;

  function addBubble(text, who="bot"){
    const el = document.createElement("div");
    el.className = "bubble " + (who === "user" ? "user" : "bot");
    el.textContent = text;
    msgs.appendChild(el);
    msgs.scrollTop = msgs.scrollHeight;
    return el;
  }

  sendBtn.addEventListener("click", ()=>{
    const text = input.value.trim();
    if(!text) return;
    addBubble(text, "user");
    input.value = "";
    assembling = addBubble("...", "bot");
    sendBtn.disabled = true;

    // evento certo + payload certo
    socket.emit("message", { message: text });
  });

  input.addEventListener("keydown", e=>{
    if(e.key === "Enter") sendBtn.click();
  });

  // resposta do back-end
  socket.on("response", ({ message }) => {
    if (assembling) {
      assembling.textContent = message;
      assembling = null;
    } else {
      addBubble(message, "bot");
    }
    sendBtn.disabled = false;
  });

  exitBtn.addEventListener("click", ()=>{
    if(window.parent !== window){
      window.parent.postMessage({ type:"FOGI_CLOSE" }, "*");
    } else {
      window.close();
    }
  });

  input.focus();
</script>


</body>
</html>
